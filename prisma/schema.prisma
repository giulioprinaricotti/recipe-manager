generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id           String      @id @default(cuid())
  email        String      @unique
  name         String?
  passwordHash String
  createdAt    DateTime    @default(now())
  recipes      Recipe[]
  mealPlans    MealPlan[]
  favourites   Favourite[]
}

model Recipe {
  id          String        @id @default(cuid())
  userId      String
  title       String
  description String?
  sourceUrl   String?
  imageUrl          String?
  imageAttribution  String?
  servings    Int?
  prepTime    Int?
  cookTime    Int?
  tags        String[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  ingredients   Ingredient[]
  instructions  Instruction[]
  mealPlanItems MealPlanItem[]
  favouritedBy  Favourite[]

  @@index([userId])
}

model Ingredient {
  id       String  @id @default(cuid())
  recipeId String
  name     String
  quantity String?
  unit     String?
  order    Int
  recipe   Recipe  @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@index([recipeId])
}

model Instruction {
  id          String @id @default(cuid())
  recipeId    String
  stepNumber  Int
  description String @db.Text
  recipe      Recipe @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@index([recipeId])
}

model MealPlan {
  id        String         @id @default(cuid())
  userId    String
  weekStart DateTime
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  user      User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  items     MealPlanItem[]

  @@unique([userId, weekStart])
  @@index([userId])
}

model MealPlanItem {
  id         String   @id @default(cuid())
  mealPlanId String
  recipeId   String
  order      Int      @default(0)
  addedAt    DateTime @default(now())
  mealPlan   MealPlan @relation(fields: [mealPlanId], references: [id], onDelete: Cascade)
  recipe     Recipe   @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@unique([mealPlanId, recipeId])
  @@index([mealPlanId])
}

model Favourite {
  userId    String
  recipeId  String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  recipe    Recipe   @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@id([userId, recipeId])
  @@index([userId])
  @@index([recipeId])
}